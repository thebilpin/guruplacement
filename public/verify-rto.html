<!DOCTYPE html>
<html>
<head>
    <title>Verify RTO User</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 600px; margin: 50px auto; padding: 20px; }
        .button { background: #28a745; color: white; padding: 15px 30px; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; }
        .button:hover { background: #218838; }
        .result { margin-top: 20px; padding: 15px; border-radius: 4px; white-space: pre-wrap; }
        .success { background: #d4edda; border: 1px solid #c3e6cb; color: #155724; }
        .error { background: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; }
        .info { background: #d1ecf1; border: 1px solid #bee5eb; color: #0c5460; }
    </style>
</head>
<body>
    <h1>üöÄ Verify RTO User</h1>
    <p><strong>User:</strong> rto@placementhero.com.au</p>
    <p><strong>Action:</strong> Set verification status to "verified"</p>
    
    <button class="button" onclick="verifyUser()">‚úÖ Verify RTO User Now</button>
    <button class="button" onclick="checkUser()" style="background: #007bff; margin-left: 10px;">üîç Check Current Status</button>
    
    <div id="result"></div>

    <script>
        async function checkUser() {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = 'Checking user status...';
            resultDiv.className = 'result info';
            
            try {
                const response = await fetch('/api/admin/verification');
                const data = await response.json();
                
                // Find the RTO user in all categories
                const allUsers = [
                    ...data.pendingVerification,
                    ...data.underReview,
                    ...data.verified,
                    ...data.rejected
                ];
                
                const rtoUser = allUsers.find(user => user.email === 'rto@placementhero.com.au');
                
                if (rtoUser) {
                    resultDiv.innerHTML = `USER FOUND!\n\nEmail: ${rtoUser.email}\nName: ${rtoUser.firstName} ${rtoUser.lastName}\nStatus: ${rtoUser.verificationStatus || 'pending'}\nOrganization: ${rtoUser.organization || 'N/A'}\nCreated: ${new Date(rtoUser.createdAt).toLocaleString()}`;
                    resultDiv.className = 'result info';
                } else {
                    resultDiv.innerHTML = 'RTO user not found in verification system';
                    resultDiv.className = 'result error';
                }
            } catch (error) {
                resultDiv.innerHTML = `ERROR: ${error.message}`;
                resultDiv.className = 'result error';
            }
        }
        
        async function verifyUser() {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = 'Verifying user...';
            resultDiv.className = 'result info';
            
            try {
                // First, get the user data
                const usersResponse = await fetch('/api/admin/verification');
                const usersData = await usersResponse.json();
                
                // Find the RTO user
                const allUsers = [
                    ...usersData.pendingVerification,
                    ...usersData.underReview,
                    ...usersData.verified,
                    ...usersData.rejected
                ];
                
                const rtoUser = allUsers.find(user => user.email === 'rto@placementhero.com.au');
                
                if (!rtoUser) {
                    resultDiv.innerHTML = 'ERROR: RTO user not found!';
                    resultDiv.className = 'result error';
                    return;
                }
                
                // Now verify the user
                const response = await fetch('/api/admin/verification', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        userId: rtoUser.id,
                        verificationStatus: 'verified',
                        verificationNotes: 'RTO user verified for login access',
                        adminId: 'system_admin'
                    })
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    resultDiv.innerHTML = `SUCCESS! ‚úÖ\n\nRTO user has been verified!\n\nUser: ${rtoUser.email}\nStatus: VERIFIED\nNotes: RTO user verified for login access\n\nüéâ The user can now login with:\nEmail: rto@placementhero.com.au\nPassword: MicrolaB631911`;
                    resultDiv.className = 'result success';
                } else {
                    resultDiv.innerHTML = `ERROR!\n\n${JSON.stringify(result, null, 2)}`;
                    resultDiv.className = 'result error';
                }
            } catch (error) {
                resultDiv.innerHTML = `NETWORK ERROR!\n\n${error.message}`;
                resultDiv.className = 'result error';
            }
        }
        
        // Auto-check status on page load
        window.addEventListener('load', checkUser);
    </script>
</body>
</html>